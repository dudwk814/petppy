<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">
<th:block th:replace="~{/fragments/basicLayout :: setContent(~{this::content})}">
    <th:block th:fragment="content">
        <section class="hero-wrap hero-wrap-2" style="background-image: url('/petppy/images/bg_2.jpg');"
                 data-stellar-background-ratio="0.5">
            <div class="overlay"></div>
            <div class="container">
                <div class="row no-gutters slider-text align-items-end">
                    <div class="col-md-9 ftco-animate pb-5">
                        <p class="breadcrumbs mb-2"><span class="mr-2"><a th:href="@{/}">Home <i
                                class="ion-ios-arrow-forward"></i></a></span> <span class="mr-2"><a
                                th:href="@{/board/}">Board <i class="ion-ios-arrow-forward"></i></a></span> <span>Board Read<i
                                class="ion-ios-arrow-forward"></i></span></p>
                        <h1 class="mb-0 bread">Board</h1>
                    </div>
                </div>
            </div>
        </section>

        <section class="ftco-section ftco-degree-bg">
            <div class="container">
                <div class="row">
                    <div class="col-lg-8 ftco-animate">
                        <p>
                            <img src="images/image_1.jpg" alt="" class="img-fluid">
                        </p>
                        <h2 class="mb-3" th:text="${board.title}"></h2>
                        <div th:utext="${board.content}">Content</div>

                        <div class="tag-widget post-tag-container mb-5 mt-5">
                            <div class="tagcloud">
                                <a href="#" class="tag-cloud-link">Life</a>
                                <a href="#" class="tag-cloud-link">Sport</a>
                                <a href="#" class="tag-cloud-link">Tech</a>
                                <a href="#" class="tag-cloud-link">Travel</a>
                            </div>
                        </div>

                        <div class="pt-5 mt-5">
                            <h5 class="mb-5">댓글 [[${#numbers.formatInteger(board.commentCount, 0, 'COMMA')}]]개</h5>
                            <ul class="comment-list">
                                    <li th:class="comment" th:data-comment="${comment.id}" th:each="comment : ${commentList}">
                                        <div class="vcard bio">
                                            <img src="/petppy/images/simbolLogo.PNG" alt="Image placeholder">
                                        </div>
                                        <div class="comment-body" id="comment-body" th:data-comment="${comment.id}"> [[${comment.email}]]
                                            <span class="meta"> [[${#temporals.format(comment.createdDate, 'yyyy-MM-dd HH:mm')}]] </span>
                                            <p>[[${comment.content}]]</p>
                                            <p><a href="#" class="fa fa-thumbs-o-up text-black-50" aria-hidden="true"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <a href="#" class="fa fa-thumbs-o-down text-black-50" aria-hidden="true"></a>&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;
                                                <a href="#" class="text-black-50 comment-input" aria-hidden="true" data-toggle="tooltip" data-placement="top" title="답글 작성">답글</a>
                                            </p>
                                            <p class="d-flex justify-content-between dropdown">
                                                <a href="#" class="reply" th:data-comment="${comment.id}">
                                                    <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> 답글 [[${#lists.size(comment.children)}]]개 보기
                                                    <span></span></a>
                                                <a href="#" style="color: grey;" id="commentDropdownBtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                    <i class="fa fa-cog fa-lg" aria-hidden="true"></i>
                                                </a>
                                            <div class="dropdown-menu" aria-labelledby="commentDropdownBtn">
                                                <a class="dropdown-item" href="#">Action</a>
                                                <a class="dropdown-item" href="#">Another action</a>
                                                <a class="dropdown-item" href="#">Something else here</a>
                                            </div>
                                            </p>
                                        </div>
                                        <th:block th:each="children : ${comment.children}">
                                            <ul class="children">
                                                <li class="comment">
                                                    <div class="vcard bio">
                                                        <img src="/petppy/images/simbolLogo.PNG" alt="Image placeholder">
                                                    </div>
                                                    <div class="comment-body" id="comment-body"> [[${children.email}]]
                                                        <span class="meta"> [[${#temporals.format(children.createdDate, 'yyyy-MM-dd HH:mm')}]] </span>
                                                        <p th:text="${children.content}"></p>
                                                        <p class="d-flex justify-content-end dropdown">
                                                            <!--<a href="#" class="reply">
                                                                <i class="fa fa-angle-down fa-lg" aria-hidden="true"></i> 답글
                                                                <span></span></a>-->
                                                            <a href="#" style="color: grey;" id="commentDropdownBtn" data-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                                                                <i class="fa fa-cog fa-lg" aria-hidden="true"></i>
                                                            </a>
                                                        <div class="dropdown-menu" aria-labelledby="commentDropdownBtn">
                                                            <a class="dropdown-item" href="#">Action</a>
                                                            <a class="dropdown-item" href="#">Another action</a>
                                                            <a class="dropdown-item" href="#">Something else here</a>
                                                        </div>
                                                        </p>
                                                    </div>
                                                </li>
                                            </ul>
                                        </th:block>
                                    </li>
                            </ul>

                            <div class="row mt-5">
                                <div class="col text-center">
                                    <div class="block-27">
                                        <ul>
                                        </ul>
                                    </div>
                                </div>
                            </div>
                            <!-- END comment-list -->

                            <div class="comment-form-wrap pt-5">
                                <div class="input-group mb-3">
                                    <div class="input-group-prepend">
                                        <div class="vcard bio" style="margin-top: 10px;">
                                            <img src="/petppy/images/simbolLogo.PNG" alt="Image placeholder">
                                        </div>
                                    </div>
                                    <input type="text" id="reply-content" class="form-control" placeholder="댓글을 입력하세요."
                                           aria-label="Recipient's username" aria-describedby="replyAddBtn">
                                    <div class="input-group-append">
                                        <button class="btn btn-outline-secondary replyAddBtn" type="button"
                                                id="replyAddBtn">등록
                                        </button>
                                    </div>
                                </div>
                            </div>
                        </div>

                    </div> <!-- .col-md-8 -->
                    <div class="col-lg-4 sidebar pl-lg-5 ftco-animate">
                        <div class="sidebar-box">
                            <form action="#" class="search-form">
                                <div class="form-group">
                                    <span class="fa fa-search"></span>
                                    <input type="text" class="form-control" placeholder="제목 OR 내용 OR 작성자">
                                </div>
                            </form>
                        </div>

                        <div class="sidebar-box ftco-animate">
                            <h3>최근 게시글</h3>
                            <div class="block-21 mb-4 d-flex" th:each="board : ${recentBoardList}">
                                <div class="text" >
                                    <h3 class="heading"><a th:href="@{/board/read(id=${board.boardId})}">[[${board.title}]]</a></h3>
                                    <div class="meta">
                                        <div><a aria-hidden="true" data-toggle="tooltip" data-placement="top" title="작성자"><span class="icon-person"></span> [[${#strings.substringBefore(board.email,'@')}]]</a></div>
                                        <div><a aria-hidden="true" data-toggle="tooltip" data-placement="top" title="작성일"><span class="icon-calendar"></span> [[${#temporals.format(board.createdDate, 'yyyy-MM-dd HH:mm')}]]</a></div>
                                        <div><a aria-hidden="true" data-toggle="tooltip" data-placement="top" title="조회수"><span class="icon-chat"></span> [[${board.hit}]]</a></div>
                                    </div>
                                </div>
                            </div>
                        </div>

                        <div class="sidebar-box ftco-animate">
                            <h3>Tag Cloud</h3>
                            <div class="tagcloud">
                                <a href="#" class="tag-cloud-link">cat</a>
                                <a href="#" class="tag-cloud-link">dog</a>
                                <a href="#" class="tag-cloud-link">pet</a>
                                <a href="#" class="tag-cloud-link">bird</a>
                                <a href="#" class="tag-cloud-link">husky</a>
                                <a href="#" class="tag-cloud-link">bulldog</a>
                                <a href="#" class="tag-cloud-link">food</a>
                            </div>
                        </div>

                    </div>

                </div>
            </div>
        </section> <!-- .section -->
    </th:block>
</th:block>
<script th:inline="javascript">
    $(document).ready(function (e) {

        var boardId = [[${board.boardId}]];

        $('.children').attr('style', 'display:none');

        /* 답글 등록 버튼 클릭 시 답글 등록 */
        $(document).on('click', '.replyAddBtn', function (e) {

            if ([[${session.user == null}]]) {
                $("#loginModal").modal("show");

                return;
            }

            var commentContent = $(this).closest('.input-group').find('#reply-content').val();


            if (commentContent.trim() === "") {
                if ($(this).closest('.input-group').find('#reply-content').hasClass('is-invalid') === true) {
                    $('#reply-content').removeClass("is-invalid");
                }
                $(this).closest(".input-group").find('input').addClass('is-invalid');
                /*$(this).closest(".input-group").append("<div class='invalid-feedback' id='comment-content-invalid-div'>" + "내용을 입력하세요 </div>");*/
                $(this).closest(".input-group").find('input').attr('placeholder', '올바른 내용을 입력해주세요.');
                return;
            }

            [# th:if = "${session.user != null}"]
            var commentDTO = {
                boardId: boardId,
                content: commentContent,
                userId: [[${session.user.id}]],
                email: [[${session.user.email}]],
                parentId: $(this).data("parent")
            };

            $.ajax({
                url: '/comment/' + boardId,
                type: 'post',
                data: JSON.stringify(commentDTO),
                contentType: 'application/json; charset=utf-8',
                dataType: 'text',
                success: function (result) {
                    console.log(result + "번 댓글이 등록되었습니다.");

                    self.location.reload();
                }
            });
            [/]

        });



        $(document).on('click', '.comment-input', function (e) {
            e.preventDefault();

            var commentBody = $(this.closest(".comment-body"));
            var parentId = commentBody.data("comment");


            if (commentBody.children('.input-group').length < 1) {
                $(commentBody).append('<div class="input-group mb-3" th:data-comment-input-group="' + parentId  +'">\n' +
                    '                  <div class="input-group-prepend">\n' +
                    '                    <div class="vcard bio" style="margin-top: 10px;">\n' +
                    '                      <img src="/petppy/images/simbolLogo.PNG" alt="Image placeholder">\n' +
                    '                    </div>\n' +
                    '                  </div>\n' +
                    '                  <input type="text" id="reply-content" class="form-control" placeholder="답글을 입력하세요." aria-label="Recipient\'s username" aria-describedby="replyAddBtn">\n' +
                    '                  <div class="input-group-append">\n' +
                    '                    <button class="btn btn-outline-secondary replyAddBtn" type="button" id="replyAddBtn" data-parent="' + parentId + '">답글 등록</button>\n' +
                    '                  </div>\n' +
                    '                </div>');
            } else {
                commentBody.children('.input-group').remove();
                return;
            }
        })

        $(document).on('click', '.reply', function (e) {
            e.preventDefault();


            if ($(this).closest('.comment').find('.children').css("display") === 'none') {
                $(this).closest('.comment').find('.children').show();
            } else {
                $(this).closest('.comment').find('.children').hide();
            }


        });
    });
</script>
</html>